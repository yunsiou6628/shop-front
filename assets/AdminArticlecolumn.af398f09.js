import{Q as n}from"./QBtn.2911309a.js";import{Q as v}from"./Ripple.aba462a3.js";import{Q as f}from"./QInput.42ba421a.js";import{Q,a as _,e as A}from"./QTable.dcb92bac.js";import{Q as B}from"./QFile.12baaa2c.js";import{Q as C}from"./QForm.7b1e0204.js";import{Q as E}from"./QCard.e340931c.js";import{Q as U}from"./QDialog.4f269d45.js";import{C as g}from"./ClosePopup.550e2973.js";import{B as x,e as u,f as D,m as a,j as i,k as s,af as p,_ as d,a0 as S,a6 as F,q as b,n as y,t as c}from"./index.4691b815.js";import"./QSpinner.d616d91f.js";import"./render.0320868f.js";import"./create.24fa76c9.js";import"./use-key-composition.74b841cb.js";import"./use-dark.66da7a17.js";import"./focus-manager.d6507951.js";import"./QSeparator.c3604565.js";import"./QList.64fdd7bb.js";import"./QSelect.d418ae92.js";import"./QItem.40708a43.js";import"./QMenu.f679400d.js";import"./selection.288b0d02.js";import"./focusout.4ed0b2ae.js";import"./use-timeout.e6337d64.js";import"./scroll.4e32588c.js";import"./rtl.4b414a6d.js";import"./use-fullscreen.49f96883.js";const I={class:"q-pa-xl"},$=a("div",{class:"text-h5 text-center text-weight-bold",style:{color:"#5E8A4B"}},"\u6587\u7AE0\u7BA1\u7406",-1),z={class:"col-12"},N=c(" \u65B0\u589E\u6587\u7AE0"),T={class:"col-12"},j={class:"text-wrapper description-textbox"},M=["src"],P=c("\u7DE8\u8F2F"),G=c("\u522A\u9664"),H={class:"q-pa-xl"},J={class:"row"},K={class:"col-12"},L={class:"col-12"},O={class:"col-12"},R={class:"col-12 q-py-lg text-grey-7"},W={class:"col-12 row justify-center q-pa-md q-pt-md"},X=c("\u53D6\u6D88 "),Y=c(" \u65B0\u589E\u6587\u7AE0 "),Z=c(" \u7DE8\u8F2F\u78BA\u8A8D "),Ce={__name:"AdminArticlecolumn",setup(ee){const r=x([]),t=x({_id:"",name:"",image:null,article:"",release:!1}),h=x({required(l){return!!l||"\u5FC5\u586B"},price(l){return l>-1||"\u5FC5\u9808\u5927\u65BC\u7B49\u65BC 0"},size(l){var e,o,m;return!l||!l.length||((o=(e=l[0])==null?void 0:e.type)==null?void 0:o.includes("image"))&&((m=l[0])==null?void 0:m.size)<1024*1024||"\u6A94\u6848\u683C\u5F0F\u4E0D\u7B26"}}),w=l=>{const e=l===""?-1:r.findIndex(o=>o._id===l);t._id=l,e>-1?(t.name=r[e].name,t.article=r[e].article,t.release=r[e].release):(t.name="",t.article="",t.release=!1),t.image=null,t.idx=e,t.dialog=!0,t.valid=!1,t.submitting=!1},q=async()=>{t.submitting=!0;const l=new FormData;for(const e in t)["_id","idx","dialog","valid","submitting"].includes(e)||l.append(e,t[e]);try{if(t._id.length===0){const{data:e}=await p.post("/article_column",l);r.push(e.result),d.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:e}=await p.patch("/article_column/"+t._id,l);r[t.idx]=e.result,d.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}t.dialog=!1}catch(e){d.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}t.submitting=!1},V=[{name:"name",required:!0,label:"\u6587\u7AE0\u6A19\u984C",align:"left",field:l=>l.name,sortable:!0},{name:"image",required:!0,label:"\u6587\u7AE0\u5716\u7247",align:"left",sortable:!0},{name:"article",required:!0,label:"\u6587\u7AE0\u5167\u5BB9",align:"left",sortable:!0},{name:"release",required:!0,label:"\u662F\u5426\u767C\u5E03\u6587\u7AE0",align:"left",field:l=>l.release?"\u767C\u5E03":"\u672A\u767C\u5E03",sortable:!0},{name:"edit",required:!0,label:"\u7DE8\u8F2F / \u522A\u9664",align:"left",sortable:!0}],k=async l=>{try{await p.delete("/article_column/"+l),await d.fire({icon:"success",title:"\u522A\u9664\u6210\u529F"});const e=r.findIndex(o=>o._id===l);r.splice(e,1)}catch(e){d.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}};return(async()=>{try{const{data:l}=await p.get("/article_column/all");r.push(...l.result),console.log(l.result),console.log(r)}catch(l){console.log(l),d.fire({icon:"error",title:"\u5931\u6557",text:"error"})}})(),(l,e)=>(u(),D("div",I,[$,a("div",z,[i(n,{style:{background:"#5E8A4B",color:"#fff"},onClick:e[0]||(e[0]=o=>w(""))},{default:s(()=>[N]),_:1})]),a("div",T,[i(Q,{class:"text-grey-7",title:"\u6587\u7AE0\u5167\u5BB9",rows:r,columns:V,"row-key":"name",filter:l.filter},{"top-right":s(()=>[i(f,{borderless:"",dense:"",debounce:"300",modelValue:l.filter,"onUpdate:modelValue":e[1]||(e[1]=o=>l.filter=o),placeholder:"Search"},{append:s(()=>[i(v,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-article":s(o=>[i(_,null,{default:s(()=>[a("div",j,S(o.row.article),1)]),_:2},1024)]),"body-cell-image":s(o=>[i(_,null,{default:s(()=>[a("img",{src:o.row.image,style:{width:"100px"}},null,8,M)]),_:2},1024)]),"body-cell-edit":s(o=>[i(_,null,{default:s(()=>[i(n,{onClick:m=>w(o.row._id)},{default:s(()=>[P]),_:2},1032,["onClick"]),i(n,{onClick:m=>k(o.row._id)},{default:s(()=>[G]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["rows","filter"])]),a("div",H,[i(U,{modelValue:t.dialog,"onUpdate:modelValue":e[7]||(e[7]=o=>t.dialog=o),persistent:""},{default:s(()=>[i(E,{class:"q-pa-lg"},{default:s(()=>[i(C,{onSubmit:F(q,["prevent"])},{default:s(()=>[a("div",J,[a("div",K,[i(f,{modelValue:t.name,"onUpdate:modelValue":e[2]||(e[2]=o=>t.name=o),label:"\u6587\u7AE0\u6A19\u984C",rules:[h.required]},null,8,["modelValue","rules"])]),a("div",L,[i(B,{modelValue:t.image,"onUpdate:modelValue":e[3]||(e[3]=o=>t.image=o),"show-size":"",accept:"image/*",label:"\u6587\u7AE0\u5716\u7247"},null,8,["modelValue"])]),a("div",O,[i(f,{modelValue:t.article,"onUpdate:modelValue":e[4]||(e[4]=o=>t.article=o),label:"\u8F38\u5165\u6587\u7AE0\u5167\u5BB9",type:"textarea",rules:[h.required],"input-style":{height:"300px"}},null,8,["modelValue","rules"])]),a("div",R,[i(A,{modelValue:t.release,"onUpdate:modelValue":e[5]||(e[5]=o=>t.release=o),label:"\u767C\u5E03"},null,8,["modelValue"])])]),a("div",W,[b((u(),y(n,{onClick:e[6]||(e[6]=o=>t.dialog=!1),style:{background:"#fff",color:"#5E8A4B"},class:"col q-py-xs q-mx-xs"},{default:s(()=>[X]),_:1})),[[g]]),t._id===""?b((u(),y(n,{key:0,type:"submit",style:{background:"#5E8A4B",color:"#fff"},class:"col q-py-xs q-mx-xs"},{default:s(()=>[Y]),_:1})),[[g]]):b((u(),y(n,{key:1,type:"submit",style:{background:"#5E8A4B",color:"#fff"},class:"col q-py-xs q-mx-xs"},{default:s(()=>[Z]),_:1})),[[g]])])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])])]))}};export{Ce as default};
