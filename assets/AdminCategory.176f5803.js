import{Q as x}from"./QInput.ab8382a0.js";import{Q as d}from"./QBtn.789ca6c0.js";import{Q as F}from"./QForm.da8aafd9.js";import{Q as S}from"./Ripple.365ceb0c.js";import{Q as U,a as V}from"./QTable.c1a1f998.js";import{Q as E}from"./QCard.8d8422ca.js";import{Q as I}from"./QDialog.2af18065.js";import{r as C,B as v,e as c,f,m as i,j as a,k as l,a6 as N,F as h,ae as _,_ as m,$ as Q,n as g,t as r,a0 as T}from"./index.52d44640.js";import"./use-key-composition.4299d499.js";import"./QSpinner.1c104e3a.js";import"./render.f6893761.js";import"./use-dark.c0245fef.js";import"./focus-manager.d6507951.js";import"./QSeparator.d878e4ab.js";import"./QList.cbbbdbb2.js";import"./QSelect.a2a0dead.js";import"./QItem.d961fed5.js";import"./QMenu.9f27b824.js";import"./selection.684a8b42.js";import"./focusout.50bd8d4d.js";import"./use-timeout.abbfc904.js";import"./scroll.4ae53630.js";import"./rtl.4b414a6d.js";import"./use-fullscreen.e860199d.js";const L=i("div",{class:"q-pt-xl"},[i("div",{class:"text-h5 text-center"},"\u5546\u54C1\u5206\u985E")],-1),M={class:"q-pa-xl"},z={class:"q-pb-xl row justify-center"},G={class:"row"},H={class:"col-12"},J=r("+"),K=r("\u2014"),O={class:"q-pt-md row justify-center"},P=r(" \u65B0\u589E\u5206\u985E "),R=r(" \u7DE8\u8F2F\u78BA\u8A8D "),W=r("\u53D6\u6D88"),X={class:"col-12"},Y=r("\u7DE8\u8F2F"),Z=r("\u522A\u9664"),ee=i("div",{class:"col-12 text-center text-h3 text-red-6 q-pa-md"},"\u6CE8\u610F!",-1),te=i("div",{class:"col-12 text-center text-h6 text-grey-8 q-pa-md"},[r("\u78BA\u5B9A\u8981\u522A\u9664\u5206\u985E\u55CE?"),i("br"),r("(\u522A\u9664\u5F8C\u5C07\u7121\u6CD5\u5FA9\u539F\u8CC7\u6599)")],-1),oe={class:"col-12 row justify-center q-pa-sm q-pt-md"},se=r("> "),Be={__name:"AdminCategory",setup(le){const y=C(""),n=v([]),e=v({_id:"",category:"",sub:[{name:""}],idx:-1,dialog:!1,valid:!1,submitting:!1}),k=()=>{e._id="",e.category="",e.sub=[{name:""}],e.idx=-1,e.dialog=!1,e.valid=!1,e.submitting=!1},$=o=>{const t=o===""?-1:n.findIndex(s=>s._id===o);e._id=o,console.log(e._id),t>-1?(e.category=n[t].category,e.sub=n[t].sub):(e.category="",e.sub=""),e.idx=t,e.dialog=!0,e.valid=!1,e.submitting=!1},B=async()=>{e.submitting=!0;const o=new FormData;for(const t in e)["_id","idx","dialog","valid","submitting"].includes(t)||o.append(t,e[t]);try{if(e._id.length===0){const{data:t}=await _.post("/products_category",e);n.push(t.result),m.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:t}=await _.patch("/products_category/"+e._id,e);n[e.idx]=t.result,m.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"}),k()}e.dialog=!1}catch(t){m.fire({icon:"error",title:"\u5931\u6557",text:t.isAxiosError?t.response.data.message:t.message})}e.submitting=!1},D=[{name:"category",required:!0,label:"\u5927\u5206\u985E",align:"left",field:o=>o.category,sortable:!0},{name:"sub",required:!0,label:"\u5C0F\u5206\u985E",align:"left",sortable:!0},{name:"edit",required:!0,label:"\u7DE8\u8F2F\u4FEE\u6539",align:"left",sortable:!0}],p=v({dialog:!1}),w=C(""),j=o=>{console.log("22222"+o),w.value=o,p.dialog=!0},A=async o=>{p.dialog=!1,console.log("0000"+o);try{await _.delete("/products_category/"+o),await m.fire({icon:"success",title:"\u522A\u9664\u6210\u529F"}),q()}catch(t){console.log("\u5931\u6557"),m.fire({icon:"error",title:"\u5931\u6557",text:t.isAxiosError?t.response.data.message:t.message})}},q=async()=>{try{const{data:o}=await _.get("/products_category/all");n.splice(0,n.length),n.push(...o.result)}catch(o){m.fire({icon:"error",title:"\u5931\u6557",text:o.isAxiosError?o.response.data.message:o.message})}};return q(),(o,t)=>(c(),f(h,null,[L,i("div",M,[i("div",z,[a(F,{onSubmit:N(B,["prevent"])},{default:l(()=>[i("div",G,[i("div",H,[a(x,{outlined:"",modelValue:e.category,"onUpdate:modelValue":t[0]||(t[0]=s=>e.category=s),label:"\u8F38\u5165\u5927\u5206\u985E"},null,8,["modelValue"])]),(c(!0),f(h,null,Q(e.sub,(s,u)=>(c(),f("div",{class:"col-12",key:u},[a(x,{outlined:"",modelValue:s.name,"onUpdate:modelValue":b=>s.name=b,label:"\u8F38\u5165\u5C0F\u5206\u985E"},null,8,["modelValue","onUpdate:modelValue"]),u===0?(c(),g(d,{key:0,onClick:b=>e.sub.push({name:""})},{default:l(()=>[J]),_:2},1032,["onClick"])):(c(),g(d,{key:1,onClick:b=>e.sub.splice(u,1),id:"submit"},{default:l(()=>[K]),_:2},1032,["onClick"]))]))),128))]),i("div",O,[e._id===""?(c(),g(d,{key:0,type:"submit",color:"secondary"},{default:l(()=>[P]),_:1})):(c(),g(d,{key:1,type:"submit",color:"yellow-8"},{default:l(()=>[R]),_:1})),a(d,{color:"primary",onClick:k},{default:l(()=>[W]),_:1})])]),_:1},8,["onSubmit"])]),i("div",X,[a(U,{title:"\u5546\u54C1\u5206\u985E\u8CC7\u6599",rows:n,columns:D,"row-key":"name",filter:y.value},{"top-right":l(()=>[a(x,{borderless:"",dense:"",debounce:"300",modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=s=>y.value=s),placeholder:"Search"},{append:l(()=>[a(S,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-sub":l(s=>[a(V,null,{default:l(()=>[(c(!0),f(h,null,Q(s.row.sub,u=>(c(),f("div",{key:u},[i("pre",null,T(u.name),1)]))),128))]),_:2},1024)]),"body-cell-edit":l(s=>[a(V,null,{default:l(()=>[a(d,{onClick:u=>$(s.row._id)},{default:l(()=>[Y]),_:2},1032,["onClick"]),a(d,{onClick:u=>j(s.row._id)},{default:l(()=>[Z]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["rows","filter"])]),a(I,{modelValue:p.dialog,"onUpdate:modelValue":t[4]||(t[4]=s=>p.dialog=s),persistent:""},{default:l(()=>[a(E,{class:"row justify-center q-py-xl my-card"},{default:l(()=>[ee,te,i("div",oe,[a(d,{onClick:t[2]||(t[2]=s=>p.dialog=!1),flat:"",outline:"",class:"col-3 q-py-xs q-mx-md bg-grey-2",label:"\u53D6\u6D88"}),a(d,{onClick:t[3]||(t[3]=s=>A(w.value)),flat:"",class:"col-3 q-py-md q-mx-xs bg-red-6 text-white",label:"\u78BA\u5B9A\u522A\u9664"})])]),_:1}),se]),_:1},8,["modelValue"])])],64))}};export{Be as default};
