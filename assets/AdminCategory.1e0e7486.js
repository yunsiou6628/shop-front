import{Q as y}from"./QInput.3026c8ba.js";import{Q as d}from"./QBtn.54a78daf.js";import{Q as A}from"./QForm.ec92adf5.js";import{Q as F}from"./Ripple.f0281775.js";import{Q as k}from"./QTd.5ff6c7cc.js";import{Q as S}from"./QTable.03fb391b.js";import{r as $,B as w,e as l,f as m,m as n,j as r,k as s,a6 as E,F as b,ae as h,_ as p,$ as V,n as _,t as u,a0 as U}from"./index.15284c64.js";import"./use-key-composition.b63c1781.js";import"./QSpinner.548b8703.js";import"./render.83420d89.js";import"./use-dark.f72c40f7.js";import"./focus-manager.d6507951.js";import"./QSeparator.e7d6514d.js";import"./QList.69cca0f5.js";import"./QSelect.4c2ec3b7.js";import"./QItem.9d2178c5.js";import"./QMenu.db75ac55.js";import"./selection.1c243c4e.js";import"./focusout.fd8c6add.js";import"./use-timeout.cd048d65.js";import"./scroll.546eae44.js";import"./QDialog.72f275bc.js";import"./rtl.4b414a6d.js";import"./use-fullscreen.9ca59804.js";const j=n("div",{class:"q-pt-xl"},[n("div",{class:"text-h5 text-center"},"\u5546\u54C1\u5206\u985E")],-1),I={class:"q-pa-xl"},N={class:"q-pb-xl row justify-center"},T={class:"row"},D={class:"col-12"},L=u("+"),M=u("\u2014"),z={class:"q-pt-md row justify-center"},G=u(" \u65B0\u589E\u5206\u985E "),H=u(" \u7DE8\u8F2F\u78BA\u8A8D "),J=u("\u53D6\u6D88"),K={class:"col-12"},O=u("\u7DE8\u8F2F"),P=u("\u522A\u9664"),ve={__name:"AdminCategory",setup(R){const f=$(""),i=w([]),e=w({_id:"",category:"",sub:[{name:""}],idx:-1,dialog:!1,valid:!1,submitting:!1}),v=()=>{e._id="",e.category="",e.sub=[{name:""}],e.idx=-1,e.dialog=!1,e.valid=!1,e.submitting=!1},C=o=>{const t=o===""?-1:i.findIndex(a=>a._id===o);e._id=o,console.log(e._id),t>-1?(e.category=i[t].category,e.sub=i[t].sub):(e.category="",e.sub=""),e.idx=t,e.dialog=!0,e.valid=!1,e.submitting=!1},Q=async()=>{e.submitting=!0;const o=new FormData;for(const t in e)["_id","idx","dialog","valid","submitting"].includes(t)||o.append(t,e[t]);try{if(e._id.length===0){const{data:t}=await h.post("/products_category",e);i.push(t.result),p.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:t}=await h.patch("/products_category/"+e._id,e);i[e.idx]=t.result,p.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"}),v()}e.dialog=!1}catch(t){p.fire({icon:"error",title:"\u5931\u6557",text:t.isAxiosError?t.response.data.message:t.message})}e.submitting=!1},q=[{name:"category",required:!0,label:"\u5927\u5206\u985E",align:"left",field:o=>o.category,sortable:!0},{name:"sub",required:!0,label:"\u5C0F\u5206\u985E",align:"left",sortable:!0},{name:"edit",required:!0,label:"\u7DE8\u8F2F\u4FEE\u6539",align:"left",sortable:!0}],B=async o=>{try{x()}catch(t){console.log("\u5931\u6557"),p.fire({icon:"error",title:"\u5931\u6557",text:t.isAxiosError?t.response.data.message:t.message})}},x=async()=>{try{const{data:o}=await h.get("/products_category/all");i.splice(0,i.length),i.push(...o.result)}catch(o){p.fire({icon:"error",title:"\u5931\u6557",text:o.isAxiosError?o.response.data.message:o.message})}};return x(),(o,t)=>(l(),m(b,null,[j,n("div",I,[n("div",N,[r(A,{onSubmit:E(Q,["prevent"])},{default:s(()=>[n("div",T,[n("div",D,[r(y,{outlined:"",modelValue:e.category,"onUpdate:modelValue":t[0]||(t[0]=a=>e.category=a),label:"\u8F38\u5165\u5927\u5206\u985E"},null,8,["modelValue"])]),(l(!0),m(b,null,V(e.sub,(a,c)=>(l(),m("div",{class:"col-12",key:c},[r(y,{outlined:"",modelValue:a.name,"onUpdate:modelValue":g=>a.name=g,label:"\u8F38\u5165\u5C0F\u5206\u985E"},null,8,["modelValue","onUpdate:modelValue"]),c===0?(l(),_(d,{key:0,onClick:g=>e.sub.push({name:""})},{default:s(()=>[L]),_:2},1032,["onClick"])):(l(),_(d,{key:1,onClick:g=>e.sub.splice(c,1),id:"submit"},{default:s(()=>[M]),_:2},1032,["onClick"]))]))),128))]),n("div",z,[e._id===""?(l(),_(d,{key:0,type:"submit",color:"secondary"},{default:s(()=>[G]),_:1})):(l(),_(d,{key:1,type:"submit",color:"yellow-8"},{default:s(()=>[H]),_:1})),r(d,{color:"primary",onClick:v},{default:s(()=>[J]),_:1})])]),_:1},8,["onSubmit"])]),n("div",K,[r(S,{title:"\u5546\u54C1\u5206\u985E\u8CC7\u6599",rows:i,columns:q,"row-key":"name",filter:f.value},{"top-right":s(()=>[r(y,{borderless:"",dense:"",debounce:"300",modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=a=>f.value=a),placeholder:"Search"},{append:s(()=>[r(F,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-sub":s(a=>[r(k,null,{default:s(()=>[(l(!0),m(b,null,V(a.row.sub,c=>(l(),m("div",{key:c},[n("pre",null,U(c.name),1)]))),128))]),_:2},1024)]),"body-cell-edit":s(a=>[r(k,null,{default:s(()=>[r(d,{onClick:c=>C(a.row._id)},{default:s(()=>[O]),_:2},1032,["onClick"]),r(d,{onClick:c=>B(a.row._id)},{default:s(()=>[P]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["rows","filter"])])])],64))}};export{ve as default};
