import{Q as d}from"./QBtn.664fa190.js";import{Q as S}from"./Ripple.1ad5663c.js";import{Q as b}from"./QInput.daf04216.js";import{Q as j,a as C}from"./QTable.a4e97d17.js";import{Q as I}from"./QForm.6785ea10.js";import{Q}from"./QCard.9cc848b6.js";import{Q as B}from"./QDialog.ac6651bb.js";import{r as A,B as v,e as c,f,m as i,j as a,k as l,F as h,af as g,_ as m,$ as E,a6 as N,n as _,t as r,a0 as T}from"./index.668e7ed8.js";import"./QSpinner.f54a6812.js";import"./render.41085fee.js";import"./create.15d453f6.js";import"./use-key-composition.9703a789.js";import"./use-dark.5f24fd8f.js";import"./focus-manager.d6507951.js";import"./QSeparator.563926a4.js";import"./QList.9d3c1100.js";import"./QSelect.84ff0795.js";import"./QItem.bca07572.js";import"./QMenu.c1004924.js";import"./selection.096a1fbd.js";import"./focusout.3d3ab7dc.js";import"./use-timeout.0c8cf330.js";import"./scroll.816336c7.js";import"./rtl.4b414a6d.js";import"./use-fullscreen.731a7bb5.js";const L=i("div",{class:"q-pt-xl"},[i("div",{class:"text-h5 text-center text-weight-bold",style:{color:"#5E8A4B"}},"\u5546\u54C1\u5206\u985E")],-1),M={class:"q-pa-xl"},z={class:"col-12"},G=r(" \u65B0\u589E\u5546\u54C1\u5206\u985E "),H={class:"col-12"},J=r("\u7DE8\u8F2F"),K=r("\u522A\u9664"),O={class:"q-pa-xl"},P={class:"row"},R={class:"col-12 q-pa-md"},W=r("+"),X=r("\u2014"),Y={class:"col-12 row justify-center q-pa-md q-pt-md"},Z=r(" \u65B0\u589E\u5206\u985E "),ee=r(" \u7DE8\u8F2F\u78BA\u8A8D "),te=r("\u53D6\u6D88"),oe=i("div",{class:"col-12 text-center text-h4 text-red-6 q-pa-md"},"\u6CE8\u610F!",-1),se=i("div",{class:"col-12 text-center text-h6 text-grey-8 q-pa-md"},[r("\u78BA\u5B9A\u8981\u522A\u9664\u5206\u985E\u55CE?"),i("br"),r("(\u522A\u9664\u5F8C\u5C07\u7121\u6CD5\u5FA9\u539F\u8CC7\u6599)")],-1),le={class:"col-12 row justify-center q-pa-sm q-pt-md"},ae=r("> "),De={__name:"AdminCategory",setup(ie){const y=A(""),n=v([]),t=v({_id:"",category:"",sub:[{name:""}],idx:-1,dialog:!1,valid:!1,submitting:!1}),k=()=>{t._id="",t.category="",t.sub=[{name:""}],t.idx=-1,t.dialog=!1,t.valid=!1,t.submitting=!1},q=o=>{const e=o===""?-1:n.findIndex(s=>s._id===o);t._id=o,e>-1?(console.log("\u9032\u5165\u7DE8\u8F2F"),t.category=n[e].category,t.sub=n[e].sub):(t.category="",t.sub=[{name:""}]),t.idx=e,t.dialog=!0,t.valid=!1,t.submitting=!1},$=async()=>{t.submitting=!0;const o=new FormData;for(const e in t)["_id","idx","dialog","valid","submitting"].includes(e)||o.append(e,t[e]);try{if(t._id.length===0){const{data:e}=await g.post("/products_category",t);n.push(e.result),m.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:e}=await g.patch("/products_category/"+t._id,t);n[t.idx]=e.result,m.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"}),k()}t.dialog=!1}catch(e){m.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}t.submitting=!1},D=[{name:"category",required:!0,label:"\u5927\u5206\u985E",align:"left",field:o=>o.category,sortable:!0},{name:"sub",required:!0,label:"\u5C0F\u5206\u985E",align:"left",sortable:!0},{name:"edit",required:!0,label:"\u7DE8\u8F2F\u4FEE\u6539",align:"left",sortable:!0}],p=v({dialog:!1}),w=A(""),U=o=>{console.log("22222"+o),w.value=o,p.dialog=!0},F=async o=>{p.dialog=!1,console.log("0000"+o);try{await g.delete("/products_category/"+o),await m.fire({icon:"success",title:"\u522A\u9664\u6210\u529F"}),V()}catch(e){console.log("\u5931\u6557"),m.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}},V=async()=>{try{const{data:o}=await g.get("/products_category/all");n.splice(0,n.length),n.push(...o.result)}catch(o){m.fire({icon:"error",title:"\u5931\u6557",text:o.isAxiosError?o.response.data.message:o.message})}};return V(),(o,e)=>(c(),f(h,null,[L,i("div",M,[i("div",z,[a(d,{style:{background:"#5E8A4B",color:"#fff"},onClick:e[0]||(e[0]=s=>q(""))},{default:l(()=>[G]),_:1})]),i("div",H,[a(j,{class:"text-grey-7",title:"\u5546\u54C1\u5206\u985E\u8CC7\u6599",rows:n,columns:D,"row-key":"name",filter:y.value},{"top-right":l(()=>[a(b,{borderless:"",dense:"",debounce:"300",modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=s=>y.value=s),placeholder:"Search"},{append:l(()=>[a(S,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-sub":l(s=>[a(C,null,{default:l(()=>[(c(!0),f(h,null,E(s.row.sub,u=>(c(),f("div",{key:u},[i("pre",null,T(u.name),1)]))),128))]),_:2},1024)]),"body-cell-edit":l(s=>[a(C,null,{default:l(()=>[a(d,{onClick:u=>q(s.row._id)},{default:l(()=>[J]),_:2},1032,["onClick"]),a(d,{onClick:u=>U(s.row._id)},{default:l(()=>[K]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["rows","filter"])]),i("div",O,[a(B,{modelValue:t.dialog,"onUpdate:modelValue":e[3]||(e[3]=s=>t.dialog=s),persistent:""},{default:l(()=>[a(Q,{class:"q-pa-lg"},{default:l(()=>[a(I,{onSubmit:N($,["prevent"])},{default:l(()=>[i("div",P,[i("div",R,[a(b,{outlined:"",modelValue:t.category,"onUpdate:modelValue":e[2]||(e[2]=s=>t.category=s),label:"\u8F38\u5165\u5927\u5206\u985E"},null,8,["modelValue"])]),(c(!0),f(h,null,E(t.sub,(s,u)=>(c(),f("div",{class:"col-12 q-pa-md",key:u},[a(b,{outlined:"",modelValue:s.name,"onUpdate:modelValue":x=>s.name=x,label:"\u8F38\u5165\u5C0F\u5206\u985E"},null,8,["modelValue","onUpdate:modelValue"]),u===0?(c(),_(d,{key:0,onClick:x=>t.sub.push({name:""}),class:"q-ma-md"},{default:l(()=>[W]),_:2},1032,["onClick"])):(c(),_(d,{key:1,onClick:x=>t.sub.splice(u,1),id:"submit",class:"q-ma-md"},{default:l(()=>[X]),_:2},1032,["onClick"]))]))),128))]),i("div",Y,[t._id===""?(c(),_(d,{key:0,type:"submit",style:{background:"#5E8A4B",color:"#fff"},class:"col q-py-xs q-mx-xs"},{default:l(()=>[Z]),_:1})):(c(),_(d,{key:1,type:"submit",style:{background:"#5E8A4B",color:"#fff"},class:"col q-py-xs q-mx-xs"},{default:l(()=>[ee]),_:1})),a(d,{onClick:k,style:{background:"#fff",color:"#5E8A4B"},class:"col q-py-xs q-mx-xs"},{default:l(()=>[te]),_:1})])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),a(B,{modelValue:p.dialog,"onUpdate:modelValue":e[6]||(e[6]=s=>p.dialog=s),persistent:""},{default:l(()=>[a(Q,{class:"row justify-center q-py-xl my-card"},{default:l(()=>[oe,se,i("div",le,[a(d,{onClick:e[4]||(e[4]=s=>p.dialog=!1),flat:"",outline:"",class:"col-3 q-py-xs q-mx-md bg-grey-2",label:"\u53D6\u6D88"}),a(d,{onClick:e[5]||(e[5]=s=>F(w.value)),flat:"",class:"col-3 q-py-xs q-mx-xs bg-red-6 text-white",label:"\u78BA\u5B9A\u522A\u9664"})])]),_:1}),ae]),_:1},8,["modelValue"])])],64))}};export{De as default};
