import{Q as n}from"./QBtn.0ec4fc58.js";import{Q as j}from"./Ripple.b280e37f.js";import{Q as x}from"./QInput.1a6841e9.js";import{Q as E,a as C}from"./QTable.47067bdc.js";import{Q as I}from"./QForm.0f5cf918.js";import{Q}from"./QCard.3910574f.js";import{Q as $}from"./QDialog.5fd4fb68.js";import{r as D,B as v,e as c,f,m as i,j as a,k as l,F as h,ae as _,_ as m,$ as B,a6 as N,n as g,t as r,a0 as T}from"./index.c246fae3.js";import"./QSpinner.31547e2a.js";import"./render.8ea1afb5.js";import"./create.c71cb389.js";import"./use-key-composition.f1caf0a8.js";import"./use-dark.a64dcf6d.js";import"./focus-manager.d6507951.js";import"./QSeparator.fdab95b7.js";import"./QList.93a1f3be.js";import"./QSelect.5e053b9b.js";import"./QItem.29ec1481.js";import"./QMenu.e335cc4f.js";import"./selection.5cc2a77f.js";import"./focusout.26a9564b.js";import"./use-timeout.d8d8ce16.js";import"./scroll.ea5a40f8.js";import"./rtl.4b414a6d.js";import"./use-fullscreen.18114e91.js";const L=i("div",{class:"q-pt-xl"},[i("div",{class:"text-h5 text-center"},"\u5546\u54C1\u5206\u985E")],-1),M={class:"q-pa-xl"},z={class:"col-12"},G=r(" \u65B0\u589E\u5546\u54C1\u5206\u985E "),H={class:"col-12"},J=r("\u7DE8\u8F2F"),K=r("\u522A\u9664"),O={class:"q-pa-xl"},P={class:"row"},R={class:"col-12"},W=r("+"),X=r("\u2014"),Y={class:"q-pt-md row justify-center"},Z=r(" \u65B0\u589E\u5206\u985E "),ee=r(" \u7DE8\u8F2F\u78BA\u8A8D "),te=r("\u53D6\u6D88"),oe=i("div",{class:"col-12 text-center text-h3 text-red-6 q-pa-md"},"\u6CE8\u610F!",-1),se=i("div",{class:"col-12 text-center text-h6 text-grey-8 q-pa-md"},[r("\u78BA\u5B9A\u8981\u522A\u9664\u5206\u985E\u55CE?"),i("br"),r("(\u522A\u9664\u5F8C\u5C07\u7121\u6CD5\u5FA9\u539F\u8CC7\u6599)")],-1),le={class:"col-12 row justify-center q-pa-sm q-pt-md"},ae=r("> "),Ae={__name:"AdminCategory",setup(ie){const y=D(""),d=v([]),t=v({_id:"",category:"",sub:[{name:""}],idx:-1,dialog:!1,valid:!1,submitting:!1}),k=()=>{t._id="",t.category="",t.sub=[{name:""}],t.idx=-1,t.dialog=!1,t.valid=!1,t.submitting=!1},w=o=>{const e=o===""?-1:d.findIndex(s=>s._id===o);t._id=o,e>-1?(t.category=d[e].category,t.sub=d[e].sub,console.log("\u958B\u555F\u5206\u985E\u8868\u55AE2")):(t.category="",t.sub=""),t.idx=e,t.dialog=!0,t.valid=!1,t.submitting=!1},U=async()=>{t.submitting=!0;const o=new FormData;for(const e in t)["_id","idx","dialog","valid","submitting"].includes(e)||o.append(e,t[e]);try{if(t._id.length===0){const{data:e}=await _.post("/products_category",t);d.push(e.result),m.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:e}=await _.patch("/products_category/"+t._id,t);d[t.idx]=e.result,m.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"}),k()}t.dialog=!1}catch(e){m.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}t.submitting=!1},A=[{name:"category",required:!0,label:"\u5927\u5206\u985E",align:"left",field:o=>o.category,sortable:!0},{name:"sub",required:!0,label:"\u5C0F\u5206\u985E",align:"left",sortable:!0},{name:"edit",required:!0,label:"\u7DE8\u8F2F\u4FEE\u6539",align:"left",sortable:!0}],p=v({dialog:!1}),V=D(""),F=o=>{console.log("22222"+o),V.value=o,p.dialog=!0},S=async o=>{p.dialog=!1,console.log("0000"+o);try{await _.delete("/products_category/"+o),await m.fire({icon:"success",title:"\u522A\u9664\u6210\u529F"}),q()}catch(e){console.log("\u5931\u6557"),m.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}},q=async()=>{try{const{data:o}=await _.get("/products_category/all");d.splice(0,d.length),d.push(...o.result)}catch(o){m.fire({icon:"error",title:"\u5931\u6557",text:o.isAxiosError?o.response.data.message:o.message})}};return q(),(o,e)=>(c(),f(h,null,[L,i("div",M,[i("div",z,[a(n,{color:"secondary",onClick:e[0]||(e[0]=s=>w(""))},{default:l(()=>[G]),_:1})]),i("div",H,[a(E,{title:"\u5546\u54C1\u5206\u985E\u8CC7\u6599",rows:d,columns:A,"row-key":"name",filter:y.value},{"top-right":l(()=>[a(x,{borderless:"",dense:"",debounce:"300",modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=s=>y.value=s),placeholder:"Search"},{append:l(()=>[a(j,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-sub":l(s=>[a(C,null,{default:l(()=>[(c(!0),f(h,null,B(s.row.sub,u=>(c(),f("div",{key:u},[i("pre",null,T(u.name),1)]))),128))]),_:2},1024)]),"body-cell-edit":l(s=>[a(C,null,{default:l(()=>[a(n,{onClick:u=>w(s.row._id)},{default:l(()=>[J]),_:2},1032,["onClick"]),a(n,{onClick:u=>F(s.row._id)},{default:l(()=>[K]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["rows","filter"])]),i("div",O,[a($,{modelValue:t.dialog,"onUpdate:modelValue":e[3]||(e[3]=s=>t.dialog=s),persistent:""},{default:l(()=>[a(Q,{class:"q-pa-lg"},{default:l(()=>[a(I,{onSubmit:N(U,["prevent"])},{default:l(()=>[i("div",P,[i("div",R,[a(x,{outlined:"",modelValue:t.category,"onUpdate:modelValue":e[2]||(e[2]=s=>t.category=s),label:"\u8F38\u5165\u5927\u5206\u985E"},null,8,["modelValue"])]),(c(!0),f(h,null,B(t.sub,(s,u)=>(c(),f("div",{class:"col-12",key:u},[a(x,{outlined:"",modelValue:s.name,"onUpdate:modelValue":b=>s.name=b,label:"\u8F38\u5165\u5C0F\u5206\u985E"},null,8,["modelValue","onUpdate:modelValue"]),u===0?(c(),g(n,{key:0,onClick:b=>t.sub.push({name:""})},{default:l(()=>[W]),_:2},1032,["onClick"])):(c(),g(n,{key:1,onClick:b=>t.sub.splice(u,1),id:"submit"},{default:l(()=>[X]),_:2},1032,["onClick"]))]))),128))]),i("div",Y,[t._id===""?(c(),g(n,{key:0,type:"submit",color:"secondary"},{default:l(()=>[Z]),_:1})):(c(),g(n,{key:1,type:"submit",color:"yellow-8"},{default:l(()=>[ee]),_:1})),a(n,{color:"primary",onClick:k},{default:l(()=>[te]),_:1})])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),a($,{modelValue:p.dialog,"onUpdate:modelValue":e[6]||(e[6]=s=>p.dialog=s),persistent:""},{default:l(()=>[a(Q,{class:"row justify-center q-py-xl my-card"},{default:l(()=>[oe,se,i("div",le,[a(n,{onClick:e[4]||(e[4]=s=>p.dialog=!1),flat:"",outline:"",class:"col-3 q-py-xs q-mx-md bg-grey-2",label:"\u53D6\u6D88"}),a(n,{onClick:e[5]||(e[5]=s=>S(V.value)),flat:"",class:"col-3 q-py-md q-mx-xs bg-red-6 text-white",label:"\u78BA\u5B9A\u522A\u9664"})])]),_:1}),ae]),_:1},8,["modelValue"])])],64))}};export{Ae as default};
