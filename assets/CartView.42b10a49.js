import{Q as m}from"./QTd.c13b8cb7.js";import{Q as s}from"./QBtn.c3c5db6b.js";import{Q as h}from"./QTable.332f6a43.js";import{Q as v}from"./QCard.11686784.js";import{u as q,B as k,c as C,e as l,f as c,m as r,j as n,k as o,F as w,ae as $,_ as x,t as d,a0 as a,$ as D,p as f}from"./index.368dcd51.js";import"./render.978b92ad.js";import"./Ripple.fab7663c.js";import"./QSpinner.695eee0e.js";import"./QSeparator.94b63770.js";import"./use-dark.b4c5c97c.js";import"./QList.d9ced16d.js";import"./QSelect.c784891c.js";import"./use-key-composition.368012d4.js";import"./focus-manager.d6507951.js";import"./QItem.a4dce002.js";import"./QMenu.6f2c92dc.js";import"./selection.21183d03.js";import"./focusout.6053c310.js";import"./use-timeout.36cb5261.js";import"./scroll.0518c4b0.js";import"./QDialog.f067c7b5.js";import"./rtl.4b414a6d.js";import"./use-fullscreen.a9c02bfc.js";const B={class:"q-pa-xl gt-md",style:{width:"100%",height:"100%","background-image":"linear-gradient(to bottom,#F4F8EE, #fff)","z-index":"-1"}},E={class:"col-12"},I=["src"],S=d("\u522A\u9664"),Q=d("-"),A={class:"q-px-lg"},L=d("+"),V={class:"col-12 text-center q-pa-xl"},F={class:"col-12 q-py-sm"},N={class:"q-pa-xl lt-lg"},T={class:"col-12",style:{color:"#5E8A4B"}},j={key:0},O={img:"img"},z=["src"],U={class:"q-ma-lg"},G={key:0},H={key:1},J={key:2},K={class:"row"},M={class:"col-3",style:{margin:"auto 0"}},P=["btn"],R=d("- "),W={class:"q-px-lg"},X=d("+ "),Y={key:3},Z={key:4},tt={key:5,class:"row justify-center"},et=["btn"],ot=d("\u522A\u9664"),rt=["src"],it=d("\u522A\u9664"),nt=d("-"),at={class:"q-px-lg"},st=d("+"),dt={class:"col-12 text-center q-pa-xl"},lt={class:"col-12 q-py-sm"},Vt={__name:"CartView",setup(ct){const y=q(),_=k([]),b=[{name:"image",required:!0,label:"\u5716\u7247",align:"left"},{name:"product",required:!0,label:"\u884C\u7A0B",align:"left",field:t=>t.product.name,format:t=>`${t}`,sortable:!0},{name:"product_date",required:!0,label:"\u884C\u7A0B\u65E5\u671F",align:"left",field:t=>t.product.name,format:t=>`${t}`,sortable:!0},{name:"quantity",required:!0,label:"\u8CFC\u8CB7\u6578\u91CF",align:"left",field:t=>t.quantity,format:t=>`${t}`},{name:"price",required:!0,label:"\u50F9\u9322",align:"left",field:t=>t.product.price,format:t=>`${t}`,sortable:!0},{name:"subtotal",required:!0,label:"\u5C0F\u8A08",align:"left",field:t=>t.product.price*t.quantity,sortable:!0},{name:"btn",required:!0,label:"\u64CD\u4F5C",align:"left"}],u=async(t,p)=>{console.log(_[t].product._id),await y.updateCart({product:_[t].product._id,quantity:p})&&(p===0?_.splice(t,1):_[t].quantity=p)};return C(()=>_.reduce((t,p)=>t+p.product.price*p.quantity,0)),(async()=>{try{const{data:t}=await $.get("/users/cart");_.push(...t.result)}catch{x.fire({icon:"error",title:"\u5931\u6557",text:"\u4F3A\u670D\u5668\u932F\u8AA4"})}})(),(t,p)=>(l(),c(w,null,[r("div",B,[r("div",E,[n(h,{title:"\u5DF2\u52A0\u5165\u884C\u7A0B",rows:_,columns:b,"row-key":"name","hide-pagination":"",style:{color:"#5E8A4B","font-weight":"bolder"}},{"body-cell-image":o(e=>[n(m,{img:t.img},{default:o(()=>[r("img",{src:e.row.product.image,style:{width:"200px"}},null,8,I)]),_:2},1032,["img"])]),"body-cell-product_date":o(e=>[n(m,{product_date:t.product_date},{default:o(()=>[d(a(new Date(e.row.product.product_date.from).toLocaleDateString())+" ~ "+a(new Date(e.row.product.product_date.to).toLocaleDateString()),1)]),_:2},1032,["product_date"])]),"body-cell-btn":o(e=>[n(m,{btn:t.btn},{default:o(()=>[n(s,{onClick:i=>u(e.rowIndex,0)},{default:o(()=>[S]),_:2},1032,["onClick"])]),_:2},1032,["btn"])]),"body-cell-quantity":o(e=>[n(m,{btn:t.btn},{default:o(()=>[n(s,{onClick:i=>u(e.rowIndex,e.row.quantity-1)},{default:o(()=>[Q]),_:2},1032,["onClick"]),r("span",A,a(e.row.quantity),1),n(s,{onClick:i=>u(e.rowIndex,e.row.quantity+1)},{default:o(()=>[L]),_:2},1032,["onClick"])]),_:2},1032,["btn"])]),_:1},8,["rows"])]),r("div",V,[r("div",F,[n(s,{to:"/ConfirmOrder",style:{color:"#fff",background:"#5E8A4B"},label:"\u78BA\u8A8D"})])])]),r("div",N,[r("div",T,[n(h,{grid:t.$q.screen.lt.md,title:"\u5DF2\u52A0\u5165\u884C\u7A0B",rows:_,columns:b,"row-key":"name","hide-pagination":"",style:{color:"#5E8A4B","font-weight":"bolder"}},{item:o(e=>[n(v,{class:"col-12 q-pa-md q-my-lg text-weight-bold",style:{color:"#5E8A4B"}},{default:o(()=>[(l(!0),c(w,null,D(e.cols,i=>(l(),c("div",{key:i.name},[i.name==="image"?(l(),c("div",j,[r("div",O,[r("img",{src:e.row.product.image,style:{width:"100%"}},null,8,z)])])):f("",!0),r("div",U,[i.name==="product"?(l(),c("div",G,[r("div",null,a(i.label)+" : "+a(i.value),1)])):f("",!0),i.name==="product_date"?(l(),c("div",H,[r("div",null,a(i.label)+" : "+a(new Date(e.row.product.product_date.from).toLocaleDateString())+" ~ "+a(new Date(e.row.product.product_date.to).toLocaleDateString()),1)])):f("",!0),i.name==="quantity"?(l(),c("div",J,[r("div",K,[r("div",M,a(i.label)+" : ",1),r("div",{btn:t.btn,class:"col-7"},[n(s,{flat:"",round:"",onClick:g=>u(e.rowIndex,e.row.quantity-1),style:{width:"10%"}},{default:o(()=>[R]),_:2},1032,["onClick"]),r("span",W,a(e.row.quantity),1),n(s,{flat:"",round:"",onClick:g=>u(e.rowIndex,e.row.quantity+1),style:{width:"10%"}},{default:o(()=>[X]),_:2},1032,["onClick"])],8,P)])])):f("",!0),i.name==="price"?(l(),c("div",Y,[r("div",null,a(i.label)+" : "+a(i.value),1)])):f("",!0),i.name==="subtotal"?(l(),c("div",Z,[r("div",null,a(i.label)+" : "+a(i.value),1)])):f("",!0),i.name==="btn"?(l(),c("div",tt,[r("div",{btn:t.btn},[n(s,{onClick:g=>u(e.rowIndex,0)},{default:o(()=>[ot]),_:2},1032,["onClick"])],8,et)])):f("",!0)])]))),128))]),_:2},1024)]),"body-cell-image":o(e=>[n(m,{img:t.img},{default:o(()=>[r("img",{src:e.row.product.image,style:{width:"200px"}},null,8,rt)]),_:2},1032,["img"])]),"body-cell-product_date":o(e=>[n(m,{product_date:t.product_date},{default:o(()=>[d(a(new Date(e.row.product.product_date.from).toLocaleDateString())+" ~ "+a(new Date(e.row.product.product_date.to).toLocaleDateString()),1)]),_:2},1032,["product_date"])]),"body-cell-btn":o(e=>[n(m,{btn:t.btn},{default:o(()=>[n(s,{onClick:i=>u(e.rowIndex,0)},{default:o(()=>[it]),_:2},1032,["onClick"])]),_:2},1032,["btn"])]),"body-cell-quantity":o(e=>[n(m,{btn:t.btn},{default:o(()=>[n(s,{onClick:i=>u(e.rowIndex,e.row.quantity-1)},{default:o(()=>[nt]),_:2},1032,["onClick"]),r("span",at,a(e.row.quantity),1),n(s,{onClick:i=>u(e.rowIndex,e.row.quantity+1)},{default:o(()=>[st]),_:2},1032,["onClick"])]),_:2},1032,["btn"])]),_:1},8,["grid","rows"])]),r("div",dt,[r("div",lt,[n(s,{to:"/ConfirmOrder",label:"\u78BA\u8A8D",style:{background:"#5E8A4B",color:"#fff"}})])])])],64))}};export{Vt as default};
