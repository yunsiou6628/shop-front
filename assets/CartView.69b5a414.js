import{Q as h,a as p}from"./QTable.1f3fa925.js";import{Q as s}from"./QBtn.0bddb3bd.js";import{Q as v}from"./QCard.b49743f8.js";import{u as q,B as k,c as C,e as l,f as c,m as r,j as n,k as o,F as w,ae as x,_ as D,t as d,a0 as a,$,p as f}from"./index.6178169d.js";import"./render.c3daa5be.js";import"./Ripple.4947cac5.js";import"./QSeparator.0b086213.js";import"./use-dark.59dc71b5.js";import"./QList.9b363a94.js";import"./QSelect.1e46fca5.js";import"./use-key-composition.ff008f3f.js";import"./QSpinner.72e61285.js";import"./focus-manager.d6507951.js";import"./QItem.29602f8e.js";import"./QMenu.9c2f2818.js";import"./selection.1c388ebb.js";import"./focusout.d385e5b7.js";import"./use-timeout.0f4d42df.js";import"./scroll.28a8cf8e.js";import"./QDialog.4880e8ec.js";import"./rtl.4b414a6d.js";import"./use-fullscreen.01a5ae26.js";const B={class:"q-pa-xl gt-md",style:{width:"100%",height:"100%","background-image":"linear-gradient(to bottom,#F4F8EE, #fff)","z-index":"-1"}},I={class:"col-12"},S=["src"],E=d("\u522A\u9664"),L=d("-"),Q={class:"q-px-lg"},A=d("+"),V={class:"col-12 text-center q-pa-xl"},F={class:"col-12 q-py-sm"},N={class:"q-pa-xl lt-lg"},T={class:"col-12",style:{color:"#5E8A4B"}},j={key:0},O={img:"img"},z=["src"],U={class:"q-ma-lg"},G={key:0},H={key:1},J={key:2},K={class:"row"},M={class:"col-3",style:{margin:"auto 0"}},P=["btn"],R=d("- "),W={class:"q-px-lg"},X=d("+ "),Y={key:3},Z={key:4},tt={key:5,class:"row justify-center"},et=["btn"],ot=d("\u522A\u9664"),rt=["src"],it=d("\u522A\u9664"),nt=d("-"),at={class:"q-px-lg"},st=d("+"),dt={class:"col-12 text-center q-pa-xl"},lt={class:"col-12 q-py-sm"},At={__name:"CartView",setup(ct){const y=q(),_=k([]),b=[{name:"image",required:!0,label:"\u5716\u7247",align:"left"},{name:"product",required:!0,label:"\u884C\u7A0B\u540D\u7A31",align:"left",field:e=>e.product.name,sortable:!0},{name:"product_date",required:!0,label:"\u884C\u7A0B\u65E5\u671F",align:"left",field:e=>e.product.name,sortable:!0},{name:"quantity",required:!0,label:"\u8CFC\u8CB7\u6578\u91CF",align:"left",field:e=>e.quantity,sortable:!0},{name:"price",required:!0,label:"\u50F9\u9322",align:"left",field:e=>e.product.price,sortable:!0},{name:"subtotal",required:!0,label:"\u5C0F\u8A08",align:"left",field:e=>e.product.price*e.quantity,sortable:!0},{name:"btn",required:!0,label:"\u64CD\u4F5C",align:"left"}],u=async(e,m)=>{console.log(_[e].product._id),await y.updateCart({product:_[e].product._id,quantity:m})&&(m===0?_.splice(e,1):_[e].quantity=m)};return C(()=>_.reduce((e,m)=>e+m.product.price*m.quantity,0)),(async()=>{try{const{data:e}=await x.get("/users/cart");_.push(...e.result)}catch{D.fire({icon:"error",title:"\u5931\u6557",text:"\u4F3A\u670D\u5668\u932F\u8AA4"})}})(),(e,m)=>(l(),c(w,null,[r("div",B,[r("div",I,[n(h,{title:"\u5DF2\u52A0\u5165\u884C\u7A0B",rows:_,columns:b,"row-key":"name","hide-pagination":"",style:{color:"#5E8A4B","font-weight":"bolder"}},{"body-cell-image":o(t=>[n(p,{img:e.img},{default:o(()=>[r("img",{src:t.row.product.image,style:{width:"200px"}},null,8,S)]),_:2},1032,["img"])]),"body-cell-product_date":o(t=>[n(p,{product_date:e.product_date},{default:o(()=>[d(a(new Date(t.row.product.product_date.from).toLocaleDateString())+" ~ "+a(new Date(t.row.product.product_date.to).toLocaleDateString()),1)]),_:2},1032,["product_date"])]),"body-cell-btn":o(t=>[n(p,{btn:e.btn},{default:o(()=>[n(s,{onClick:i=>u(t.rowIndex,0)},{default:o(()=>[E]),_:2},1032,["onClick"])]),_:2},1032,["btn"])]),"body-cell-quantity":o(t=>[n(p,{btn:e.btn},{default:o(()=>[n(s,{onClick:i=>u(t.rowIndex,t.row.quantity-1)},{default:o(()=>[L]),_:2},1032,["onClick"]),r("span",Q,a(t.row.quantity),1),n(s,{onClick:i=>u(t.rowIndex,t.row.quantity+1)},{default:o(()=>[A]),_:2},1032,["onClick"])]),_:2},1032,["btn"])]),_:1},8,["rows"])]),r("div",V,[r("div",F,[n(s,{to:"/ConfirmOrder",style:{color:"#fff",background:"#5E8A4B"},label:"\u78BA\u8A8D"})])])]),r("div",N,[r("div",T,[n(h,{grid:e.$q.screen.lt.md,title:"\u5DF2\u52A0\u5165\u884C\u7A0B",rows:_,columns:b,"row-key":"name","hide-pagination":"",style:{color:"#5E8A4B","font-weight":"bolder"}},{item:o(t=>[n(v,{class:"col-12 q-pa-md q-my-lg text-weight-bold text-grey-7"},{default:o(()=>[(l(!0),c(w,null,$(t.cols,i=>(l(),c("div",{key:i.name},[i.name==="image"?(l(),c("div",j,[r("div",O,[r("img",{src:t.row.product.image,style:{width:"100%"}},null,8,z)])])):f("",!0),r("div",U,[i.name==="product"?(l(),c("div",G,[r("div",null,a(i.label)+" : "+a(i.value),1)])):f("",!0),i.name==="product_date"?(l(),c("div",H,[r("div",null,a(i.label)+" : "+a(new Date(t.row.product.product_date.from).toLocaleDateString())+" ~ "+a(new Date(t.row.product.product_date.to).toLocaleDateString()),1)])):f("",!0),i.name==="quantity"?(l(),c("div",J,[r("div",K,[r("div",M,a(i.label)+" : ",1),r("div",{btn:e.btn,class:"col-7"},[n(s,{flat:"",round:"",onClick:g=>u(t.rowIndex,t.row.quantity-1),style:{width:"10%"}},{default:o(()=>[R]),_:2},1032,["onClick"]),r("span",W,a(t.row.quantity),1),n(s,{flat:"",round:"",onClick:g=>u(t.rowIndex,t.row.quantity+1),style:{width:"10%"}},{default:o(()=>[X]),_:2},1032,["onClick"])],8,P)])])):f("",!0),i.name==="price"?(l(),c("div",Y,[r("div",null,a(i.label)+" : "+a(i.value),1)])):f("",!0),i.name==="subtotal"?(l(),c("div",Z,[r("div",null,a(i.label)+" : "+a(i.value),1)])):f("",!0),i.name==="btn"?(l(),c("div",tt,[r("div",{btn:e.btn},[n(s,{onClick:g=>u(t.rowIndex,0)},{default:o(()=>[ot]),_:2},1032,["onClick"])],8,et)])):f("",!0)])]))),128))]),_:2},1024)]),"body-cell-image":o(t=>[n(p,{img:e.img},{default:o(()=>[r("img",{src:t.row.product.image,style:{width:"200px"}},null,8,rt)]),_:2},1032,["img"])]),"body-cell-product_date":o(t=>[n(p,{product_date:e.product_date},{default:o(()=>[d(a(new Date(t.row.product.product_date.from).toLocaleDateString())+" ~ "+a(new Date(t.row.product.product_date.to).toLocaleDateString()),1)]),_:2},1032,["product_date"])]),"body-cell-btn":o(t=>[n(p,{btn:e.btn},{default:o(()=>[n(s,{onClick:i=>u(t.rowIndex,0)},{default:o(()=>[it]),_:2},1032,["onClick"])]),_:2},1032,["btn"])]),"body-cell-quantity":o(t=>[n(p,{btn:e.btn},{default:o(()=>[n(s,{onClick:i=>u(t.rowIndex,t.row.quantity-1)},{default:o(()=>[nt]),_:2},1032,["onClick"]),r("span",at,a(t.row.quantity),1),n(s,{onClick:i=>u(t.rowIndex,t.row.quantity+1)},{default:o(()=>[st]),_:2},1032,["onClick"])]),_:2},1032,["btn"])]),_:1},8,["grid","rows"])]),r("div",dt,[r("div",lt,[n(s,{to:"/ConfirmOrder",label:"\u78BA\u8A8D",style:{background:"#5E8A4B",color:"#fff"}})])])])],64))}};export{At as default};
