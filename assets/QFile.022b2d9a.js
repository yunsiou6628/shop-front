import{b as B}from"./QSelect.331897d5.js";import{u as K,a as T,j as U,b as G,k as H,d as J,c as M,l as W,e as X,f as C,m as Y}from"./use-key-composition.5b22bb79.js";import{u as Z}from"./QInput.13edc7a5.js";import{c as ee}from"./create.271cd6e4.js";import{r as x,c as n,h as o,g as te,L as le}from"./index.c74ba9e5.js";var se=ee({name:"QFile",inheritAttrs:!1,props:{...K,...T,...U,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...G,...H],setup(e,{slots:s,emit:V,attrs:S}){const{proxy:p}=te(),u=J(),r=x(null),v=x(!1),A=M(e),{pickFiles:j,onDragover:I,onDragleave:P,processFiles:k,getDndNode:q}=W({editable:u.editable,dnd:v,getFileInput:y,addFilesToQueue:h}),L=Z(e),l=n(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),g=n(()=>C(l.value)),N=n(()=>l.value.map(t=>t.name).join(", ")),b=n(()=>Y(l.value.reduce((t,a)=>t+a.size,0))),O=n(()=>({totalSize:b.value,filesNumber:l.value.length,maxFiles:e.maxFiles})),_=n(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:A.value,...S,id:u.targetUid.value,disabled:u.editable.value!==!0})),D=n(()=>"q-file q-field--auto-height"+(v.value===!0?" q-file--dnd":"")),F=n(()=>e.multiple===!0&&e.append===!0);function d(t){const a=l.value.slice();a.splice(t,1),m(a)}function Q(t){const a=l.value.findIndex(t);a>-1&&d(a)}function m(t){V("update:modelValue",e.multiple===!0?t:t[0])}function z(t){t.keyCode===13&&le(t)}function E(t){(t.keyCode===13||t.keyCode===32)&&j(t)}function y(){return r.value}function h(t,a){const i=k(t,a,l.value,F.value),f=y();f!=null&&(f.value=""),i!==void 0&&((e.multiple===!0?e.modelValue&&i.every(w=>l.value.includes(w)):e.modelValue===i[0])||m(F.value===!0?l.value.concat(i):i))}function c(){return[o("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function R(){if(s.file!==void 0)return l.value.length===0?c():l.value.map((a,i)=>s.file({index:i,file:a,ref:this}));if(s.selected!==void 0)return l.value.length===0?c():s.selected({files:l.value,ref:this});if(e.useChips===!0)return l.value.length===0?c():l.value.map((a,i)=>o(B,{key:"file-"+i,removable:u.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{d(i)}},()=>o("span",{class:"ellipsis",textContent:a.name})));const t=e.displayValue!==void 0?e.displayValue:N.value;return t.length>0?[o("div",{class:e.inputClass,style:e.inputStyle,textContent:t})]:c()}function $(){const t={ref:r,..._.value,...L.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:h};return e.multiple===!0&&(t.multiple=!0),o("input",t)}return Object.assign(u,{fieldClass:D,emitValue:m,hasValue:g,inputRef:r,innerValue:l,floatingLabel:n(()=>g.value===!0||C(e.displayValue)),computedCounter:n(()=>{if(e.counterLabel!==void 0)return e.counterLabel(O.value);const t=e.maxFiles;return`${l.value.length}${t!==void 0?" / "+t:""} (${b.value})`}),getControlChild:()=>q("file"),getControl:()=>{const t={ref:u.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return u.editable.value===!0&&Object.assign(t,{onDragover:I,onDragleave:P,onKeydown:z,onKeyup:E}),o("div",t,[$()].concat(R()))}}),Object.assign(p,{removeAtIndex:d,removeFile:Q,getNativeElement:()=>r.value}),X(u)}});export{se as Q};
